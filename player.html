<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YouTube Video Player UI Bootstrap</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Google Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="styles.css" rel="stylesheet">
  <style>
    /* Responsive video wrapper for 16:9 aspect ratio */
    .video-responsive {
      position: relative;
      width: 100%;
      padding-top: 56.25%; /* 16:9 Aspect Ratio */
      background: #000;
      overflow: hidden;
    }
    .video-responsive iframe,
    .video-responsive video,
    .video-responsive img {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      border: 0;
      object-fit: cover;
      background: #000;
      display: block;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-light bg-white fixed-top shadow-sm px-3">
    <a class="navbar-brand" href="#">YouTube</a>
    <form class="d-flex search-bar mx-auto" style="flex:1;max-width:500px;">
      <input class="form-control" type="search" placeholder="Search">
      <button class="btn btn-outline-secondary" type="submit">
        <span class="material-icons">search</span>
      </button>
    </form>
  </nav>
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-2 sidebar d-none d-md-block position-fixed">
        <div class="menu-item"><span class="material-icons">home</span> Home</div>
        <div class="menu-item"><span class="material-icons">subscriptions</span> Subscriptions</div>
        <div class="menu-item"><span class="material-icons">video_library</span> Library</div>
        <div class="menu-item"><span class="material-icons">history</span> History</div>
      </div>
      <div class="col-md-10 offset-md-2 pt-4">
        <div class="row mt-5">
          <div class="col-12">
            <!-- Video Player -->
            <div class="card mb-4" style="border-radius: 12px; overflow: hidden;">
              <div class="video-responsive" id="video-container">
                <!-- Video will be injected here -->
              </div>
              <div class="card-body">
                <div class="video-title" id="video-title"></div>
                <div class="video-meta">Channel Name</div>
                <div class="video-meta">1M views • 2 days ago</div>
              </div>
            </div>
            <!-- /Video Player -->
          </div>
        </div>
      </div>
    </div>
  </div>
  <nav class="mobile-footer" style="display: none;">
    <div class="footer-item active">
      <span class="material-icons">home</span>
      <span>Home</span>
    </div>
    <div class="footer-item">
      <span class="material-icons">subscriptions</span>
      <span>Subscriptions</span>
    </div>
    <div class="footer-item">
      <span class="material-icons">video_library</span>
      <span>Library</span>
    </div>
    <div class="footer-item">
      <span class="material-icons">history</span>
      <span>History</span>
    </div>
  </nav>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- The following script should be appended before </body> in player.html -->

<script>
  // Helper: Shuffle array
  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  // Simple match scoring (from index.html)
  function getMatchScore(title, query) {
    if (!query) return 0;
    title = title.toLowerCase();
    query = query.toLowerCase();
    if (title === query) return 100;
    const queryWords = query.split(/\s+/);
    let score = 0;
    queryWords.forEach(word => {
      if (title.includes(word)) score += 10;
    });
    if (title.startsWith(query)) score += 10;
    if (title.includes(query)) score += 20;
    return score;
  }

  // Render related video cards below the player
  function renderRelatedVideos(videos) {
    let relatedDiv = document.getElementById('related-videos');
    if (!relatedDiv) {
      relatedDiv = document.createElement('div');
      relatedDiv.id = 'related-videos';
      relatedDiv.className = 'mt-3 mb-5';
      const parent = document.querySelector('.col-md-10.offset-md-2.pt-4 .row.mt-5');
      parent && parent[0]
        ? parent[0].appendChild(relatedDiv)
        : document.querySelector('.col-md-10.offset-md-2.pt-4').appendChild(relatedDiv);
    }
    relatedDiv.innerHTML = `<h5 class="mb-3">Related Videos</h5>
      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4" id="related-video-grid"></div>`;
    const grid = document.getElementById('related-video-grid');
    grid.innerHTML = '';

    // Limit to 8 related videos
    videos.slice(0, 8).forEach((video, idx) => {
      // Show match score as badge if it exists
      const scoreBadge = video._matchScore
        ? `<span class="badge bg-secondary float-end" style="font-size:12px;">Score: ${video._matchScore}</span>`
        : '';
      const col = document.createElement('div');
      col.className = 'col';
      col.innerHTML = `
        <div class="card video-card" style="cursor:pointer" data-index="${idx}">
          <img src="${video.thumbnail}" class="card-img-top" alt="Thumbnail" loading="lazy">
          <div class="card-body">
            <div class="video-info">
              <img src="https://via.placeholder.com/40" class="channel-icon" alt="Channel Icon">
              <div style="flex:1;">
                <div class="video-title">${video.title}</div>
                <div class="video-meta">Channel Name</div>
                <div class="video-meta">1M views • 2 days ago</div>
                ${scoreBadge}
              </div>
            </div>
          </div>
        </div>
      `;
      // Video card click: send query if present
      col.querySelector('.video-card').addEventListener('click', function() {
        const params = new URLSearchParams({
          title: video.title || '',
          thumbnail: video.thumbnail || '',
          url: video.videoUrl || ''
        });
        if (query) params.set('query', query);
        window.location.href = 'player.html?' + params.toString();
      });
      grid.appendChild(col);
    });
  }

  // Fetch and display related/random videos
  let query = getQueryParam('query') || '';
  let currentTitle = getQueryParam('title') || '';
  fetch('videos.json')
    .then(response => response.json())
    .then(videos => {
      let allVideos = [];
      if (Array.isArray(videos)) {
        allVideos = videos;
      } else if (Array.isArray(videos.videos)) {
        allVideos = videos.videos;
      } else if (Array.isArray(videos.series)) {
        videos.series.forEach(seriesItem => {
          if (Array.isArray(seriesItem.videos)) {
            allVideos = allVideos.concat(seriesItem.videos);
          }
        });
      }
      // Remove the current video from the list
      allVideos = allVideos.filter(v => (v.title || '') !== currentTitle);

      if (query) {
        // Score and sort by match
        const scoredVideos = allVideos
          .map(video => ({
            ...video,
            _matchScore: getMatchScore(video.title || '', query)
          }))
          .filter(v => v._matchScore > 0)
          .sort((a, b) => b._matchScore - a._matchScore);
        // If no good matches, show random
        if (scoredVideos.length) {
          renderRelatedVideos(scoredVideos);
        } else {
          renderRelatedVideos(shuffleArray(allVideos));
        }
      } else {
        // No query: show random
        renderRelatedVideos(shuffleArray(allVideos));
      }
    })
    .catch(error => {
      // Error fallback
      let relatedDiv = document.getElementById('related-videos');
      if (!relatedDiv) {
        relatedDiv = document.createElement('div');
        relatedDiv.id = 'related-videos';
        relatedDiv.className = 'mt-3 mb-5';
        document.querySelector('.col-md-10.offset-md-2.pt-4').appendChild(relatedDiv);
      }
      relatedDiv.innerHTML = '<div class="text-danger">Failed to load related videos.</div>';
      console.error('Error loading videos:', error);
    });
</script>

<!-- Add this container in your HTML below the video player card, for example: -->
<!-- <div id="related-videos"></div> -->
</body>
</html>
